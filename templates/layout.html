<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Secure File Transfer{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>

<body>
    <!-- 3D Background -->
    <div id="canvas-container"></div>

    <!-- Animation Overlay -->
    <div id="processing-overlay"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(10px); z-index: 1000; justify-content: center; align-items: center; flex-direction: column;">
        <div id="animation-canvas" style="width: 300px; height: 300px;"></div>
        <div id="progress-text" style="color: #00f2ff; font-size: 2rem; font-weight: bold; margin-top: 20px;">0%</div>
        <div style="color: white; margin-top: 10px;">Processing...</div>
    </div>

    <!-- Navigation -->
    <nav>
        <a href="{{ url_for('dashboard') }}" class="logo">SECURE<span style="color:white">TRANSFER</span></a>
        <div class="nav-links">
            {% if session.get('user') %}
            <a href="{{ url_for('dashboard') }}">Dashboard</a>
            <a href="{{ url_for('audio_page') }}">Audio</a>
            <a href="{{ url_for('video_page') }}">Video</a>
            <a href="{{ url_for('doc_page') }}">Documents</a>
            <a href="{{ url_for('history') }}">History</a>
            <a href="{{ url_for('settings') }}">Settings</a>
            <a href="{{ url_for('logout') }}" class="btn-logout">Logout</a>
            {% else %}
            <a href="{{ url_for('login') }}">Login</a>
            <a href="{{ url_for('register') }}">Register</a>
            {% endif %}
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container">
        <!-- Flash Messages -->
        <div class="flash-messages">
            {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
            {% for category, message in messages %}
            <div class="flash {{ category }}">{{ message }}</div>
            {% endfor %}
            {% endif %}
            {% endwith %}
        </div>

        {% block content %}{% endblock %}
    </div>

    <!-- Scripts -->
    <script src="{{ url_for('static', filename='js/background.js') }}"></script>
    <script src="{{ url_for('static', filename='js/animation.js') }}"></script>
    <script>
        // Theme Management
        function applyTheme(theme) {
            const root = document.documentElement;
            if (theme === 'light') {
                root.style.setProperty('--bg-color', '#f0f2f5');
                root.style.setProperty('--text-color', '#111111');
                root.style.setProperty('--glass-bg', 'rgba(0, 0, 0, 0.05)');
                root.style.setProperty('--glass-border', 'rgba(0, 0, 0, 0.1)');
                root.style.setProperty('--text-muted', '#666666');
            } else if (theme === 'dark') {
                root.style.setProperty('--bg-color', '#050505');
                root.style.setProperty('--text-color', '#ffffff');
                root.style.setProperty('--glass-bg', 'rgba(255, 255, 255, 0.05)');
                root.style.setProperty('--glass-border', 'rgba(255, 255, 255, 0.1)');
                root.style.setProperty('--text-muted', '#aaaaaa');
            } else {
                // System Default
                if (window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) {
                    applyTheme('light');
                } else {
                    applyTheme('dark');
                }
            }
        }

        function changeTheme(theme) {
            localStorage.setItem('theme', theme);
            applyTheme(theme);
        }

        // Initialize
        const savedTheme = localStorage.getItem('theme') || 'system';
        applyTheme(savedTheme);
    </script>
</body>

</html>